<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Snake Ultimate</title>

<style>
:root {
  --bg: linear-gradient(135deg, #1d2671, #c33764);
  --panel: rgba(255,255,255,.15);
  --text: #fff;
}
* { box-sizing: border-box; font-family: system-ui, sans-serif; }

body {
  margin: 0;
  min-height: 100vh;
  background: var(--bg);
  display: flex;
  justify-content: center;
  align-items: center;
  color: var(--text);
}

.container {
  width: min(95vw, 420px);
  background: var(--panel);
  backdrop-filter: blur(14px);
  border-radius: 20px;
  padding: 14px;
  position: relative;
  text-align: center;
}

canvas {
  width: 100%;
  aspect-ratio: 1;
  background: rgba(0,0,0,.35);
  border-radius: 12px;
}

.stats { margin-bottom: 6px; }

.overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.75);
  display: flex;
  justify-content: center;
  align-items: center;
}

.overlay-content { animation: pop .4s ease; }

@keyframes pop {
  from { transform: scale(.6); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

button {
  font-size: 1.2rem;
  padding: 10px 24px;
  border-radius: 12px;
  border: none;
  background: #4ade80;
  color: #000;
  cursor: pointer;
}

.banner {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: #dc2626;
  padding: 6px 14px;
  border-radius: 10px;
  display: none;
}

/* MOBILE ARROW CONTROLS */
.mobile-controls {
  display: none;
  margin-top: 12px;
  user-select: none;
}

.mobile-controls button {
  width: 64px;
  height: 64px;
  font-size: 1.6rem;
  border-radius: 12px;
  border: none;
  background: rgba(255,255,255,.25);
  color: #fff;
}

.mobile-controls .row {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 8px;
}

/* Show only on touch devices */
@media (pointer: coarse) {
  .mobile-controls {
    display: block;
  }
}

</style>
</head>

<body>
<div class="container">

<div class="banner" id="bossBanner">‚ö† BOSS LEVEL</div>

<div class="stats">
  Score <span id="score">0</span> |
  Level <span id="level">1</span> |
  High <span id="high">0</span>
</div>

<div id="challenge"></div>

<canvas id="game" width="400" height="400"></canvas>

<!-- MOBILE CONTROLS -->
<div class="mobile-controls">
  <button data-dir="up">‚¨Ü</button>
  <div class="row">
    <button data-dir="left">‚¨Ö</button>
    <button data-dir="down">‚¨á</button>
    <button data-dir="right">‚û°</button>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="overlay-content">
    <h2>üêç Snake Ultimate</h2>
    <p id="skinText"></p>
    <div style="margin: 12px 0;">
      <label>
        <input type="radio" name="difficulty" value="easy" checked>
        Easy
      </label>
      &nbsp;&nbsp;
      <label>
        <input type="radio" name="difficulty" value="medium">
        Medium
      </label>
      &nbsp;&nbsp;
      <label>
        <input type="radio" name="difficulty" value="hard">
        Hard
      </label>
    </div>
    <button id="startBtn">Start</button>
  </div>
</div>

</div>

<!-- AUDIO -->
<audio id="eatSound" src="sound/eat.mp3" preload="auto"></audio>
<audio id="loseSound" src="sound/lose.mp3" preload="auto"></audio>

<script>
/* ---------- CANVAS ---------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const grid = 20;
const tiles = canvas.width / grid;

/* ---------- UI ---------- */
const scoreEl = document.getElementById("score");
const levelEl = document.getElementById("level");
const highEl = document.getElementById("high");
const overlay = document.getElementById("overlay");
const skinText = document.getElementById("skinText");
const banner = document.getElementById("bossBanner");
const challengeEl = document.getElementById("challenge");

/* ---------- AUDIO ---------- */
const eatSound = document.getElementById("eatSound");
const loseSound = document.getElementById("loseSound");

/* ---------- GAME STATE ---------- */
let snake, dir, food, score, level, speed;
let particles = [];
let boss = null;
let bossDir = { x:0, y:0 };
let paused = true;
let lastTime = 0, acc = 0;
let difficulty = "easy";

/* ---------- BOSS FOOD SPAWN LOGIC ---------- */
let bossAppearFood = 15;
let bossHideAfter = 5;
let bossFoodCounter = 0;

/* ---------- STORAGE / HIGH SCORES ---------- */
let highScores = {
  easy: +localStorage.getItem("snakeHigh_easy") || 0,
  medium: +localStorage.getItem("snakeHigh_medium") || 0,
  hard: +localStorage.getItem("snakeHigh_hard") || 0
};
highEl.textContent = highScores[difficulty];

/* ---------- SKINS ---------- */
const skins = [
  { name:"Classic", unlock:1, color:"#4ade80", particle:"#4ade80" },
  { name:"Fire", unlock:3, color:"#f97316", particle:"#fb923c" },
  { name:"Ice", unlock:6, color:"#38bdf8", particle:"#7dd3fc" },
  { name:"Neon", unlock:10, neon:true }
];
let skin = skins[0];

/* ---------- DAILY CHALLENGE ---------- */
function initChallenge() {
  const today = new Date().toDateString();
  let data = JSON.parse(localStorage.getItem("dailyChallenge") || "{}");

  if (data.date !== today) {
    const options = [
      { text: "Eat 15 food", check: () => score >= 15 },
      { text: "Reach Level 6", check: () => level >= 6 },
      { text: "Score 20 points", check: () => score >= 20 }
    ];
    data = { date: today, text: options[Math.floor(Math.random()*3)].text, done:false };
    localStorage.setItem("dailyChallenge", JSON.stringify(data));
  }
  challengeEl.textContent = "üéØ " + data.text + (data.done ? " ‚úî" : "");
}

/* ---------- START GAME ---------- */
function startGame() {
  snake = [{ x:10, y:10, px:10, py:10 }];
  dir = { x:1, y:0 };
  food = spawnFood();
  particles = [];
  boss = null;
  bossFoodCounter = 0;
  score = 0;
  level = 1;
  speed = 140;
  paused = false;
  lastTime = acc = 0;

  scoreEl.textContent = score;
  levelEl.textContent = level;
  highEl.textContent = highScores[difficulty];

  updateSkin();
  initChallenge();

  banner.style.display = "none";
  overlay.style.display = "none";

  requestAnimationFrame(loop);
}

/* ---------- GAME OVER ---------- */
function gameOver() {
  paused = true;
  loseSound.currentTime = 0;
  loseSound.play();

  if (score > highScores[difficulty]) {
    highScores[difficulty] = score;
    localStorage.setItem(`snakeHigh_${difficulty}`, score);
  }
  highEl.textContent = highScores[difficulty];
  overlay.style.display = "flex";
}

/* ---------- UPDATE ---------- */
function update() {
  const h = snake[0];
  let nx = h.x + dir.x;
  let ny = h.y + dir.y;

  /* ---------- WALL WRAP / DEATH ---------- */
  if (difficulty === "easy" || difficulty === "medium") {
    if (nx < 0) nx = tiles - 1;
    if (nx >= tiles) nx = 0;
    if (ny < 0) ny = tiles - 1;
    if (ny >= tiles) ny = 0;
  } else if (difficulty === "hard") {
    if (nx < 0 || ny < 0 || nx >= tiles || ny >= tiles) return gameOver();
  }

  /* ---------- SELF COLLISION ---------- */
  if ((difficulty === "medium" || difficulty === "hard") &&
      snake.some(s => s.x === nx && s.y === ny)) return gameOver();

  /* ---------- BOSS COLLISION (circular) ---------- */
  if (boss) {
    const bossX = boss.x * grid + grid/2;
    const bossY = boss.y * grid + grid/2;
    const snakeX = nx * grid + grid/2;
    const snakeY = ny * grid + grid/2;
    
    const dx = bossX - snakeX;
    const dy = bossY - snakeY;
    const distance = Math.sqrt(dx*dx + dy*dy);
    const bossRadius = (grid * 1.5)/2; // match circular boss radius

    if (distance < bossRadius) return gameOver();
  }

  snake.forEach(s => { s.px = s.x; s.py = s.y; });
  snake.unshift({ x: nx, y: ny, px: h.x, py: h.y });

  emitParticles(h.x, h.y);

  /* ---------- FOOD ---------- */
  if (nx === food.x && ny === food.y) {
    eatSound.currentTime = 0;
    eatSound.play();

    score++;
    scoreEl.textContent = score;

    bossFoodCounter++;

    // Spawn boss after 15 food eaten
    if (!boss && score >= bossAppearFood) {
      spawnBoss();
      bossFoodCounter = 0;
    }

    // Hide boss after 5 more food eaten
    if (boss && bossFoodCounter >= bossHideAfter) {
      boss = null;
    }

    if (score % 5 === 0) {
      level++;
      levelEl.textContent = level;
      speed = Math.max(60, speed - 10);
      updateSkin();
    }

    food = spawnFood();
  } else snake.pop();

  /* ---------- BOSS FLOATING ---------- */
  if (boss) {
    boss.x += bossDir.x * 0.1;
    boss.y += bossDir.y * 0.1;
    boss.x = Math.max(0, Math.min(tiles - 1, boss.x));
    boss.y = Math.max(0, Math.min(tiles - 1, boss.y));
  }

  /* ---------- WALL-BOUNCE BOSS MOVEMENT ---------- */
if (boss) {
  const bossRadiusTiles = 0.75; // matches grid * 1.5 / 2

  boss.x += bossDir.x * 0.1;
  boss.y += bossDir.y * 0.1;

  // Bounce horizontally
  if (boss.x <= bossRadiusTiles || boss.x >= tiles - 1 - bossRadiusTiles) {
    bossDir.x *= -1;
    boss.x = Math.max(
      bossRadiusTiles,
      Math.min(tiles - 1 - bossRadiusTiles, boss.x)
    );
  }

  // Bounce vertically
  if (boss.y <= bossRadiusTiles || boss.y >= tiles - 1 - bossRadiusTiles) {
    bossDir.y *= -1;
    boss.y = Math.max(
      bossRadiusTiles,
      Math.min(tiles - 1 - bossRadiusTiles, boss.y)
    );
  }
}


  updateChallenge();
}

/* ---------- DRAW ---------- */
function draw(a) {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* ---------- FOOD: Animated Frog ---------- */
  const fx = food.x * grid + grid/2;
  const fy = food.y * grid + grid/2;
  const bounce = Math.sin(Date.now()/200) * 4;

  ctx.save();
  ctx.translate(fx, fy - bounce);

  // Body
  ctx.fillStyle = "#4ade80";
  ctx.beginPath();
  ctx.arc(0,0,grid/2 - 2,0,Math.PI*2);
  ctx.fill();

  // Eyes
  ctx.fillStyle = "#fff";
  ctx.beginPath();
  ctx.arc(-6,-6,4,0,Math.PI*2);
  ctx.arc(6,-6,4,0,Math.PI*2);
  ctx.fill();

  // Pupils
  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.arc(-6,-6,2,0,Math.PI*2);
  ctx.arc(6,-6,2,0,Math.PI*2);
  ctx.fill();

  ctx.restore();

  /* ---------- BOSS: Circular Pulsing + Chasing Eyes ---------- */
  if (boss) {
    const bx = boss.x * grid + grid/2;
    const by = boss.y * grid + grid/2;
    const baseSize = grid * 1.5;
    const pulse = Math.sin(Date.now()/200) * 4;
    const size = baseSize + pulse;
    const hue = (Date.now()/10)%360;

    ctx.fillStyle = `hsl(${hue}, 80%, 50%)`;
    ctx.beginPath();
    ctx.arc(bx, by, size/2, 0, Math.PI*2);
    ctx.fill();

    // Eyes follow snake head
    const head = snake[0];
    const hx = head.x * grid + grid/2;
    const hy = head.y * grid + grid/2;
    const angle = Math.atan2(hy - by, hx - bx);

    const eyeOffset = 12;
    const pupilOffset = 3;

    const leftEyeX = bx - eyeOffset;
    const leftEyeY = by - eyeOffset;
    const rightEyeX = bx + eyeOffset;
    const rightEyeY = by - eyeOffset;

    ctx.fillStyle = "#000";
    ctx.beginPath();
    ctx.arc(leftEyeX + Math.cos(angle)*pupilOffset, leftEyeY + Math.sin(angle)*pupilOffset, 3, 0, Math.PI*2);
    ctx.arc(rightEyeX + Math.cos(angle)*pupilOffset, rightEyeY + Math.sin(angle)*pupilOffset, 3, 0, Math.PI*2);
    ctx.fill();
  }

  /* ---------- SNAKE ---------- */
  snake.forEach((s,i)=>{
    const x=(s.px+(s.x-s.px)*a)*grid;
    const y=(s.py+(s.y-s.py)*a)*grid;

    ctx.fillStyle = skin.neon
      ? `hsl(${Date.now()/10%360},100%,60%)`
      : skin.color;

    ctx.beginPath();
    ctx.roundRect(x+2, y+2, grid-4, grid-4, i===0?8:6);
    ctx.fill();

    if (i===0){
      const ox = dir.x*4;
      const oy = dir.y*4;
      ctx.fillStyle="#000";
      ctx.beginPath();
      ctx.arc(x+grid/2-4+ox, y+grid/2-4+oy,2,0,Math.PI*2);
      ctx.arc(x+grid/2+4+ox, y+grid/2-4+oy,2,0,Math.PI*2);
      ctx.fill();
    }
  });

  // particles
  particles.forEach((p,i)=>{
    p.life--;
    ctx.globalAlpha=p.life/20;
    ctx.fillStyle=p.color;
    ctx.fillRect(p.x,p.y,4,4);
    if(p.life<=0) particles.splice(i,1);
  });
  ctx.globalAlpha=1;
}

/* ---------- HELPERS ---------- */
const rand = () => Math.floor(Math.random()*tiles);
const spawnFood = () => ({ x:rand(), y:rand() });

function updateSkin() {
  skin = skins.filter(s=>level>=s.unlock).slice(-1)[0];
  skinText.textContent = "Skin: " + skin.name;
}

function emitParticles(x,y) {
  particles.push({
    x:x*grid+grid/2,
    y:y*grid+grid/2,
    life:20,
    color: skin.neon ? `hsl(${Math.random()*360},100%,60%)` : skin.particle
  });
}

function spawnBoss() {
  boss = { x: rand(), y: rand() };
  bossDir = {
    x: Math.random() < 0.5 ? 1 : -1,
    y: Math.random() < 0.5 ? 1 : -1
  };

  banner.style.display = "block";
  setTimeout(() => banner.style.display = "none", 1500);
}

function updateChallenge() {
  const data = JSON.parse(localStorage.getItem("dailyChallenge"));
  if (!data || data.done) return;
  if (
    (data.text.includes("15") && score>=15) ||
    (data.text.includes("Level") && level>=6) ||
    (data.text.includes("20") && score>=20)
  ) {
    data.done = true;
    localStorage.setItem("dailyChallenge", JSON.stringify(data));
    challengeEl.textContent = "üéØ " + data.text + " ‚úî";
  }
}

/* ---------- LOOP ---------- */
function loop(t) {
  if (paused) return;
  if (!lastTime) lastTime=t;
  acc+=t-lastTime;
  lastTime=t;
  while(acc>=speed){update();acc-=speed;}
  draw(acc/speed);
  requestAnimationFrame(loop);
}

/* ---------- INPUT ---------- */
document.addEventListener("keydown", e=>{
  if(paused) startGame();
  if(e.key==="ArrowUp" && dir.y!==1) dir={x:0,y:-1};
  if(e.key==="ArrowDown" && dir.y!==-1) dir={x:0,y:1};
  if(e.key==="ArrowLeft" && dir.x!==1) dir={x:-1,y:0};
  if(e.key==="ArrowRight" && dir.x!==-1) dir={x:1,y:0};
});

document.querySelectorAll(".mobile-controls button").forEach(btn=>{
  btn.addEventListener("touchstart", e=>{
    e.preventDefault();
    const d=btn.dataset.dir;
    if(paused) startGame();
    if(d==="up" && dir.y!==1) dir={x:0,y:-1};
    if(d==="down" && dir.y!==-1) dir={x:0,y:1};
    if(d==="left" && dir.x!==1) dir={x:-1,y:0};
    if(d==="right" && dir.x!==-1) dir={x:1,y:0};
  });
});

/* ---------- DIFFICULTY SELECTOR ---------- */
document.querySelectorAll('input[name="difficulty"]').forEach(radio=>{
  radio.addEventListener("change", e=>{
    difficulty=e.target.value;
    highEl.textContent=highScores[difficulty];
  });
});

document.getElementById("startBtn").onclick=startGame;
</script>
</body>
</html>
